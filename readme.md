# xshowidx ver.0.2 2021/10/28

現在，枠の出力で不具合発生中．要注意（twocoloumnの状況で壊れてます）


はるか以前，LaTeX2.09のころに，`showidx.sty`という「スタイルファイル」がありました．手元にあるものには1988年2月2日という日付が記載されています．このスタイルファイルでは，ページに存在する`\index`の引数をそのページの欄外に出力する仕組みが定義されているのですが，ボックスや脚注にある`\index`を欄外に出すことはできませんでした．じつは，この`showidx`，2021年現在になってもまだ要求されることがあります．

もういい加減いやになったので違う方法で書き直したのがこの`xshowidx`です．ついでに，版面を示す「枠」も出せるようにしました．

## パッケージオプション

````
\usepcakage[<keyval list>]{xshowidx}

<keyval list> := <key>=<val>(, <key>=<val>)*
<key> := sep | width | framewidth | crosslength | font | frametype | showidx | showframe | noframe | guide
````

- `sep`：値は長さで，デフォルトは10mm．版面から索引項目の出力までに距離を示します．
- `width`：値は長さで，デフォルトは10em．索引項目の出力領域の幅を示します．
- `framewidth`：値は長さで，デフォルトは0.4pt．版面を示す枠の太さを示します．
- `crosslength`：値は長さで，デフォルトは10mm．版面を示す枠の四隅のはみ出し量を示します．
- `font`：フォントやサイズを指定するコマンドを指定します．デフォルトは`\footnotesize`．索引項目を出力すフォントやサイズを示します．
- `frametype`：枠の形を示します．デフォルトは`corner`．`corner`と`all`が指定でき，`corner`は四隅のみの枠，`all`は版面全体を囲む枠を指定します．
- `showidx`：索引項目を出力するかしないかを指定します．デフォルトは`true`．`true`で出力，`false`で出力しないことを示します．
- `showframe`：枠を出すか出さないかを指定します，デフォルトは`true`．`true`で枠を出力，`false`で枠を出力しないことを示します．
- `noframe`：枠を出すか出さないかを指定します，`true`，`false`の値をとることができますが，単に`noframe`だけ指定することを想定しています．`noframe`は`showframe=false`のエイリアスです．
- `guide`：本文中の索引項目と欄外の出力の間に直線を結びます．デフォルトでは引きません．これは組版結果に影響を及ぼすのであくまでも確認用です．

パッケージのデフォルトは，`sep,width,framewidth,crosslength,showidx,font,frametype,showframe`となっているので，必要に応じて読み込み時に指定しなおしてください．

## 仕様

### `guide`オプションの注意

`guide`オプションはあくまでも確認用です．組版結果に影響を及ぼします．内部でtikzを呼び出しnodeを動的に定義してガイドの線分を引きますのでページ分割が変わるとnodeの位置が変わってエラーが出ることがありますが，無視してコンパイルを繰り返してください．また，現状では線分はページ構築の最初に行われるため，ページの構成要素はガイドの線分の上に引かれます．

### idxファイルの利用

索引項目を得るためにidxファイルを利用します．そのため，`\makeindex`コマンドはxshowidxパッケージの読み込みよりも後に実行してください（`\makeindex`コマンドでidx生成のためのストリームを開くと，idxファイルの中身はクリアされてしまいます）．

`\makeindex`コマンドを先に実行している場合は，それを検知してxshowidxは実質的に何もせず，コンパイル終了時にターミナルとログにメッセージを書き出すので確認してください．

### ページの枠について

ページの枠はすこしfragileな処理になっています．ページ分割に際に`\rightskip`や`\leftskip`のように1行の長さを実質的に変更する状態になっている場合に枠がずれるかもしれません．対処は施していますが，テストパターンが足りないかもしれません．


### `\raggedbottom`，`\flushbottom`との衝突

LaTeX2eでは`\raggedbottom`と`flushbottom`と`letter.cls`でしか使われていないと思われる，`output`ルーチンへのフックを流用しています．最近のLaTeX2eで実装が追加されているhookシステムは使っていません．衝突はしないように処置はしていますが，何かのはずみで衝突した場合は，枠や索引項目が出力されなくなります．






